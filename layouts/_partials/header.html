{{/* Detecteer alternative_nav - pak van pagina of hoogste ancestor */}}
{{- $alternativeNav := "" -}}
{{- $navTitle := .Site.Title -}}
{{- $navURL := site.Home.RelPermalink -}}

{{- if .Params.alternative_nav -}}
  {{- $alternativeNav = .Params.alternative_nav -}}
  {{- $navTitle = .Title -}}
  {{- $navURL = .RelPermalink -}}
{{- end -}}

{{- range .Ancestors -}}
  {{- if .Params.alternative_nav -}}
    {{- $alternativeNav = .Params.alternative_nav -}}
    {{- $navTitle = .Title -}}
    {{- $navURL = .RelPermalink -}}
  {{- end -}}
{{- end -}}

{{- $hasAlternativeNav := ne $alternativeNav "" -}}

<header{{ if $hasAlternativeNav }} class="has-alternative-nav"{{ end }}>
  <div class="banner">
    <div class="site-info">
      <p class="title">
        {{ if not .IsHome }}<a href="/">{{ end }}{{ .Site.Title }}{{ if not .IsHome }}</a>{{ end }}
      </p>
      <p class="tagline">{{ .Site.Params.tagline }}</p>
    </div>
    <div class="site-logo">
      {{ if .IsHome }}
      <img src="{{ relURL "images/logo-rijksoverheid.svg" }}" alt="Logo Rijksoverheid" />
      {{ else }}
      <a href="/" tabindex="-1" aria-hidden="true">
        <img src="{{ relURL "images/logo-rijksoverheid.svg" }}" alt="Logo Rijksoverheid" />
      </a>
      {{ end }}
    </div>
  </div>

  <nav id="main-nav" class="navbar" aria-label="Hoofdnavigatie">
    {{/* Mobiele titel - alleen zichtbaar op kleine schermen */}}
    {{ if eq $navURL .RelPermalink }}
    <span class="title">{{ $navTitle }}</span>
    {{ else }}
    <a href="{{ $navURL }}" class="title">{{ $navTitle }}</a>
    {{ end }}

    {{/* Desktop menu - main of alternative */}}
    <div class="menu">
      <ul>
        {{- $navMenu := cond $hasAlternativeNav (index .Site.Menus $alternativeNav) .Site.Menus.main -}}
        {{ range $navMenu }}
          {{- $isActive := or (eq $.RelPermalink .URL) (and .URL (ne .URL "/") (hasPrefix $.RelPermalink .URL)) -}}
          {{- if eq .Params.special "toggle-mainmenu" -}}
          {{/* Speciale toggle button voor hoofdmenu */}}
          <li>
            <button class="nav-menu-toggle" aria-expanded="false" aria-controls="secondary-nav" data-text="{{ .Name }}">
              {{ .Name }}
            </button>
          </li>
          {{- else -}}
          <li>
            <a href="{{ .URL }}" data-text="{{ .Name }}"{{ if $isActive }} class="active" aria-current="page"{{ end }}>
              {{ .Name }}
            </a>
          </li>
          {{- end -}}
        {{ end }}
      </ul>
    </div>

    <ul class="navbar-right">
      <li>
        <button class="search-trigger" aria-label="Zoeken" aria-haspopup="dialog">
          {{- partial "icon.html" "search" -}}
          <span class="search-trigger-text">Zoeken...</span>
          <kbd class="search-shortcut">/</kbd>
        </button>
      </li>
      <li>
        <button id="theme-toggle" class="theme-toggle" aria-label="Wissel thema">
          {{- partial "icon.html" "sun" -}}
          {{- partial "icon.html" "moon" -}}
        </button>
      </li>
    </ul>

    <button class="search-trigger mobile-search" aria-label="Zoeken" aria-haspopup="dialog">
      {{- partial "icon.html" "search" -}}
    </button>

    <button class="theme-toggle mobile-theme" aria-label="Wissel thema" onclick="document.getElementById('theme-toggle').click()">
      {{- partial "icon.html" "sun" -}}
      {{- partial "icon.html" "moon" -}}
    </button>

    <button
      class="toggle"
      aria-label="Menu openen"
      aria-expanded="false"
      aria-controls="mobile-menu"
      onclick="
        const expanded = this.getAttribute('aria-expanded') === 'false';
        this.setAttribute('aria-expanded', expanded);
        this.setAttribute('aria-label', expanded ? 'Menu sluiten' : 'Menu openen');
      "
    >
      {{- partial "icon.html" "menu" -}}
    </button>

    <div id="mobile-menu" class="mobile" role="navigation" aria-label="Mobiel menu">
      <ul>
        {{ range .Site.Menus.main }}
        <li><a href="{{ .URL }}"{{ if or ($.IsMenuCurrent "main" .) ($.HasMenuCurrent "main" .) (eq $.RelPermalink .URL) }} class="active" aria-current="page"{{ end }}>{{ .Name }}</a></li>
        {{ end }}
        {{ range .Site.Menus.secondary }}
        <li><a href="{{ .URL }}" target="_blank" rel="external noopener noreferrer">{{ .Name }}</a></li>
        {{ end }}
      </ul>
    </div>
  </nav>

  {{/* Hoofdmenu bar - verschijnt onder navbar bij alternative_nav */}}
  {{ if $hasAlternativeNav }}
  <nav id="secondary-nav" class="navbar navbar-sub" hidden aria-label="Sitebrede navigatie">
    <ul>
      {{ range .Site.Menus.main }}
      <li><a href="{{ .URL }}" data-text="{{ .Name }}"{{ if or ($.IsMenuCurrent "main" .) ($.HasMenuCurrent "main" .) (eq $.RelPermalink .URL) }} class="active" aria-current="page"{{ end }}>{{ .Name }}</a></li>
      {{ end }}
    </ul>
  </nav>
  {{ end }}

  {{ if not .IsHome }}
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <ol>
      <li>
        <a href="/">Home</a>
        <span class="separator" aria-hidden="true"></span>
      </li>
      {{ range .Ancestors.Reverse }}
      {{ if not .IsHome }}
      <li>
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        <span class="separator" aria-hidden="true"></span>
      </li>
      {{ end }}
      {{ end }}
      <li>
        <span class="current" aria-current="page">{{ .Title }}</span>
      </li>
    </ol>
  </nav>
  {{ end }}
</header>
