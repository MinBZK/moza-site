{{/*
  Sidebar navigatie partial
  Verwacht: sidebar: true in cascade, vindt automatisch root
*/}}
{{ if .Params.sidebar }}
{{/* Vind de root sectie */}}
{{- $root := . -}}
{{- range .Ancestors -}}
  {{- if .Params.sidebar -}}
    {{- $root = . -}}
  {{- end -}}
{{- end -}}

<nav class="sidebar-nav" aria-label="Sectie navigatie">
  {{/* Mobiele navbar - zichtbaar < 900px */}}
  <div class="navbar navbar-sidebar">
    <button class="sidebar-toggle" aria-expanded="false" aria-controls="sidebar-nav-content" data-text="Inhoudsopgave {{ $root.Title }}">
      Inhoudsopgave {{ $root.Title }}
    </button>
  </div>

  <div id="sidebar-nav-content" class="sidebar-inner">
    <h2><a href="{{ $root.RelPermalink }}">{{ $root.Title }}</a></h2>

    <ul class="sidebar-sections">
      {{/* Secties met hun subpagina's */}}
      {{ range $root.Sections.ByWeight }}
        {{- $isCurrentSection := eq $.RelPermalink .RelPermalink -}}
        {{- $hasCurrentPage := false -}}
        {{- range .RegularPages -}}
          {{- if eq $.RelPermalink .RelPermalink -}}
            {{- $hasCurrentPage = true -}}
          {{- end -}}
        {{- end -}}
        {{- $isExpanded := or $isCurrentSection $hasCurrentPage -}}
        <li class="sidebar-section">
          {{ if .RegularPages }}
          <div class="section-header">
            <button
              class="section-toggle"
              aria-expanded="{{ $isExpanded }}"
              aria-label="Toon subpagina's van {{ .Title }}"
              onclick="this.setAttribute('aria-expanded', this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true')"
            >â€º</button>
            <a href="{{ .RelPermalink }}" class="section-link"{{ if $isCurrentSection }} aria-current="page"{{ end }}>
              {{ .Title }}
            </a>
          </div>
          <ul class="sidebar-pages">
            {{ range .RegularPages.ByWeight.ByLinkTitle }}
            <li{{ if eq $.RelPermalink .RelPermalink }} class="active"{{ end }}>
              <a href="{{ .RelPermalink }}"{{ if eq $.RelPermalink .RelPermalink }} aria-current="page"{{ end }}>
                {{ .Title }}
              </a>
            </li>
            {{ end }}
          </ul>
          {{ else }}
          <a href="{{ .RelPermalink }}" class="section-link"{{ if $isCurrentSection }} aria-current="page"{{ end }}>
            {{ .Title }}
          </a>
          {{ end }}
        </li>
      {{ end }}
      {{/* Losse pagina's direct onder root */}}
      {{ range $root.RegularPages.ByWeight.ByLinkTitle }}
        <li class="sidebar-section">
          <a href="{{ .RelPermalink }}" class="section-link"{{ if eq $.RelPermalink .RelPermalink }} aria-current="page"{{ end }}>
            {{ .Title }}
          </a>
        </li>
      {{ end }}
    </ul>
  </div>
</nav>
{{ end }}
