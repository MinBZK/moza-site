<!doctype html><html lang=nl><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>notificatieservice | MijnOverheid Zakelijk</title><meta name=description content="Bij MijnOverheid Zakelijk staan ondernemers centraal. Elk uur minder aan gedoe, is een uur meer ondernemen. We zorgen voor overzicht en makkelijk zaken doen. Met elkaar bouwen we zo aan nieuwe digitale snelwegen."><link rel=icon href=/moza-site/preview/pr-34/favicon.ico type=image/x-icon><link rel=stylesheet href=/moza-site/preview/pr-34/css/style.d7b5263c47ca3ec112794ed40ce533e2.css><script src=/moza-site/preview/pr-34/js/bundle.f708e6c53039c684a38ddc8d9c70bc8a.js defer></script></head><body><a href=#main-content class=skip-link>Ga naar de inhoud</a><header><div class=banner><div class=site-info><p class=title><a href=/>MijnOverheid Zakelijk</a></p><p class=tagline>Makkelijk zaken doen met de overheid</p></div><div class=site-logo><a href=/ tabindex=-1 aria-hidden=true><img src=/moza-site/preview/pr-34/images/logo-rijksoverheid.svg alt="Logo Rijksoverheid"></a></div></div><nav class=navbar aria-label=Hoofdnavigatie><a href=/ class=title>MijnOverheid Zakelijk</a><div class=menu><ul><li><a href=/moza-site/preview/pr-34/ data-text=Home>Home</a></li><li><a href=/moza-site/preview/pr-34/over-moza/ data-text="Over MOZa">Over MOZa</a></li><li><a href=/moza-site/preview/pr-34/actueel/ data-text=Actueel>Actueel</a></li><li><a href=/moza-site/preview/pr-34/onderwerpen/ data-text=Onderwerpen>Onderwerpen</a></li><li><a href=/moza-site/preview/pr-34/documentatie/ data-text=Documentatie class=active aria-current=page>Documentatie</a></li><li><a href=/moza-site/preview/pr-34/contact/ data-text=Contact>Contact</a></li></ul><ul class=navbar-right><li><button class=search-trigger aria-label=Zoeken aria-haspopup=dialog><svg class="search-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5.0 100 11 5.5 5.5.0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75.0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg><span class=search-trigger-text>Zoeken...</span>
<kbd class=search-shortcut>/</kbd></button></li><li><button id=theme-toggle class=theme-toggle aria-label="Toggle theme"><svg class="sun" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364-.707.707M6.343 17.657l-.707.707m12.728.0-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg><svg class="moon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg></button></li></ul></div><button class="search-trigger mobile-search" aria-label=Zoeken aria-haspopup=dialog><svg class="search-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5.0 100 11 5.5 5.5.0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75.0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg></button>
<button class="theme-toggle mobile-theme" aria-label="Wissel thema" onclick='document.getElementById("theme-toggle").click()'><svg class="sun" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364-.707.707M6.343 17.657l-.707.707m12.728.0-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg><svg class="moon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg></button>
<button class=toggle aria-label="Menu openen" aria-expanded=false aria-controls=mobile-menu onclick='const expanded=this.getAttribute("aria-expanded")==="false";this.setAttribute("aria-expanded",expanded),this.setAttribute("aria-label",expanded?"Menu sluiten":"Menu openen")'><svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=mobile-menu class=mobile role=navigation aria-label="Mobiel menu"><ul><li><a href=/moza-site/preview/pr-34/>Home</a></li><li><a href=/moza-site/preview/pr-34/over-moza/>Over MOZa</a></li><li><a href=/moza-site/preview/pr-34/actueel/>Actueel</a></li><li><a href=/moza-site/preview/pr-34/onderwerpen/>Onderwerpen</a></li><li><a href=/moza-site/preview/pr-34/documentatie/ class=active aria-current=page>Documentatie</a></li><li><a href=/moza-site/preview/pr-34/contact/>Contact</a></li><li class=mobile-theme-toggle><button class=theme-toggle aria-label="Toggle theme" onclick='document.getElementById("theme-toggle").click()'>
<span class=sun>Light Mode</span>
<span class=moon>Dark Mode</span></button></li></ul></div></nav><nav class=breadcrumb aria-label=Breadcrumb><ol><li><a href=/>Home</a>
<span class=separator aria-hidden=true></span></li><li><a href=/moza-site/preview/pr-34/documentatie/>Documentatie</a>
<span class=separator aria-hidden=true></span></li><li><span class=current aria-current=page>notificatieservice</span></li></ol></nav></header><main id=main-content><article class=docs><h1>Notificatieservice</h1><div class=content><h2 id=context>Context</h2><p>Binnen MijnOverheid Zakelijk is betrouwbare, tijdige en kanaalonafhankelijke communicatie richting burgers en ondernemers essentieel om te voldoen aan de Wet MEBV. Waar de <code>Profiel Service</code> voorziet in het vastleggen van contactgegevens en voorkeuren, faciliteert de Notificatie Service het daadwerkelijk versturen van berichten en attenderingen via verschillende kanalen (zoals e‑mail, sms, push of toekomstige kanalen) en het registreren van de afleversstatus.</p><p>De Notificatie Service opereert als generieke voorziening tussen overheidsdiensten en verzendkanalen/platforms.
Dit maakt het mogelijk om notificaties consistent aan te bieden, kanaalkeuzes van de gebruiker te respecteren en technische verschillen tussen verzendproviders af te schermen.</p><h3 id=uitdagingen>Uitdagingen</h3><ul><li>Fragmentatie van kanalen en leveranciers: elke dienstverlener heeft eigen integraties en afleverbewijzen.</li><li>Doelbinding en voorkeuren: notificaties moeten aansluiten op door de gebruiker opgegeven voorkeuren en rechtmatig worden verzonden.</li><li>Betrouwbaarheid en traceerbaarheid: afleversstatus, retries, dead‑lettering en auditlogs moeten uniform worden geborgd.</li><li>Schaalbaarheid en piekbelasting: grote aantallen attenderingen & kennisgevingen bij gebeurtenissen.</li><li>Beveiliging en privacy: persoonsgegevens minimaliseren, end‑to‑end beveiliging en conformiteit met wet‑ en regelgeving (o.a. AVG, MEBV).</li><li>Toekomstvastheid: eenvoudig nieuwe kanalen en providers kunnen aansluiten zonder wijzigingen bij afnemende diensten.</li></ul><h3 id=doel>Doel</h3><p><strong>Overheidsorganisaties/Dienstverleners</strong> kunnen via één generieke interface templates aanmaken, en via een API deze afleveren over meerdere kanalen.</p><p><strong>Ondernemers</strong> ontvangen attenderingen & kennisgevingen volgens hun opgegeven voorkeuren via betrouwbare, herkenbare en veilige kanalen.</p><p>De Notificatie Service abstraheert kanaalspecifieke complexiteit, past verzendbeleid en throttling toe, en registreert gebeurtenissen en afleversresultaten voor inzicht en verantwoording.</p><iframe id=structurizr-diagram src="/diagrammen/index.html?iframe=structurizr-diagram#NotificatieServiceContext" width=100% height=800px></iframe>
## Functioneel overzicht<h3 id=inleiding>Inleiding</h3><p>Dit hoofdstuk bouwt voort op de context en verwijst naar aanvullende documentatie en diagrammen.
Het biedt kort en duidelijk inzicht in wat de Notificatie Service doet, voor wie het dat doet en hoe de belangrijkste informatiestromen lopen.</p><h3 id=overzicht>Overzicht</h3><p>De Notificatie Service biedt één generieke voorziening waarmee overheidsorganisaties notificaties (attenderingen/kennisgevingen) kunnen aanmaken, routeren en afleveren via meerdere kanalen (o.a. e‑mail, sms, push en toekomstige kanalen).
De service schermt kanaalspecifieke verschillen af, respecteert voorkeuren en doelbinding.</p><p>Wat het systeem feitelijk doet, is notificatieverzoeken betrouwbaar aannemen, verrijken, en afleveren, met observatie op status en foutafhandeling.
Belangrijke gebruikers en hun behoeften zijn:</p><ul><li>Dienstverlener/Vakapplicaties: via API een notificatie kunnen aanmaken, met feedback over (tussen)status en eindresultaat.</li><li>Kanaalproviders/voorzieningen (bijv. NotifyNL): gestandaardiseerde aansturing en terugmeldingen via uniforme contracten.</li></ul><h4 id=kernfunctionaliteiten-in-het-kort>Kernfunctionaliteiten in het kort:</h4><ul><li>Notificaties aanmaken: API voor het registreren van een notificatieverzoek met metadata (template, correlatie‑ID).</li><li>Routering en aflevering: aanbieden aan het juiste kanaal of provider; ondersteunen van meerdere providers en failover.</li><li>Status & callbacks: vastleggen van (tussen)statussen; callbacks/webhooks naar de aanroeper; idempotente statusupdates.</li><li>Retries & dead‑lettering: configureerbare retry‑strategie per kanaal; Dead Letter Queue (DLQ) voor niet‑afleverbare berichten.</li><li>Logging & audit: gebeurtenissen vastleggen conform LDV; correlatie‑ID’s voor traceerbaarheid end‑to‑end.</li></ul><h4 id=belangrijkste-processen-en-informatiestromen>Belangrijkste processen en informatiestromen:</h4><ol><li><p>Aanname notificatieverzoek – Een vakapplicatie doet een verzoek tot notificatie.</p><ul><li>De Notificatie Service valideert het verzoek, bewaart een initiële status (bijv. Accepted/Queued).</li><li>Koppelt terug wanneer de status uiteindelijk naar Succeeded/Failed gaat.</li></ul></li><li><p>Kanaalkeuze en voorkeursverwerking – De aannamen is dat de vakapplicatie de kanaal en voorkeur al heeft vastgelegd.</p><ul><li>In sommige van de scenario&rsquo;s is de notificatie service wel verantwoordelijk voor kanaalherstel & het ophalen van adresgegevens.</li></ul></li><li><p>Aflevering en status – De service biedt het bericht aan bij de gekozen provider (bijv. NotifyNL) en registreert tussenstappen (Enqueued, Sent, Delivered/Failed).</p><ul><li>Callbacks vanaf de provider worden verwerkt en beschikbaar gesteld aan de aanroeper.</li></ul></li><li><p>Retries, failover en fallback – Bij tijdelijke fouten worden retries toegepast met circuit-breaker &lsquo;back‑off&rsquo;&rsquo;.</p><ul><li>Indien overeengekomen, kan de OMC als fallback overschakelen naar een alternatieve kanaalstrategie.</li><li>^ TODO DISCUSSIEPUNT, moet het mogelijk zijn een geprioriteerde lijst van contactmethodes op kunnen sturen naar de notificatie service</li></ul></li></ol><h4 id=scenarios>Scenario’s</h4><p>Onderstaande scenario’s illustreren de samenwerking tussen vakapplicatie, Notificatie Service, Profiel Service en verzendvoorzieningen.
Dit zijn de welbekende scenario&rsquo;s over hoe overheidsdiensten zouden kunnen interacteren met de Notificatie Service.
Scenario 9 staat hier nog niet, maar is idem aan scenario 8, met de toevoeging van kanaalherstel.</p><h5 id=scenario-2--vakapplicatie-belt-direct-de-notificatie-service>Scenario 2 — Vakapplicatie belt direct de Notificatie Service</h5><p><img src=images/Scenario2.png alt="Scenario 2 uitgetekend" title="Scenario 2 uitgetekend"></p><details><summary>Zie mermaid code</summary><pre><code>mermaid
sequenceDiagram
    actor Medewerker
    Medewerker-&gt;&gt;Vakapplicatie:
    activate Vakapplicatie
    Vakapplicatie-&gt;&gt;Notificatie service:Verstuur verzoek tot notificatie
    activate Notificatie service
    Notificatie service--&gt;&gt;Vakapplicatie:
    deactivate Vakapplicatie
    Notificatie service--&gt;&gt;Vakapplicatie:Notificatie status update callback
    deactivate Notificatie service
    activate Vakapplicatie
    Vakapplicatie-&gt;&gt;Vakapplicatie:Afhandeling callback
    deactivate Vakapplicatie
</code></pre></details><h5 id=scenario-8--vakapplicatie-via-omc-met-profielverrijking-en-fallback>Scenario 8 — Vakapplicatie via OMC met profielverrijking en fallback</h5><p><img src=images/Scenario8GeenLDV.png alt="Scenario 8 uitgetekend" title="Scenario 8 uitgetekend"></p><details><summary>Zie mermaid code</summary><pre><code>mermaid
sequenceDiagram
    actor Medewerker
    Medewerker-&gt;&gt;Vakapplicatie:'
    activate Vakapplicatie
    Vakapplicatie-&gt;&gt;OMC:Verstuur verzoek tot notificatie
    deactivate Vakapplicatie
    activate OMC
    OMC-&gt;&gt;Profiel service:Haal contact inforamtie op o.b.v. kvknummer
    activate Profiel service
    Profiel service--&gt;&gt;OMC:'
    deactivate Profiel service
    OMC-&gt;&gt;Notificatie service:Verstuur verzoek tot notificatie
    activate Notificatie service
    deactivate OMC
    
    Notificatie service--&gt;&gt;OMC:Notificatie status update callback
    deactivate Notificatie service
    activate OMC
    alt status = mislukt
    OMC-&gt;&gt;Profiel service:Haal adres gegevens op o.b.v. kvknummer
    activate Profiel service
    Profiel service--&gt;&gt;OMC:'
    deactivate Profiel service
    OMC-&gt;&gt;Notificatie service:Stuur verzoek tot brief
    activate Notificatie service
    Notificatie service--&gt;&gt;OMC:Brief callback
    deactivate Notificatie service
    end
    deactivate OMC
    OMC--&gt;&gt;Vakapplicatie:Optionele callback
</code></pre></details>## Kwaliteitseisen<h3 id=inleiding-1>Inleiding</h3><p>Dit hoofdstuk vat de belangrijkste niet-functionele eisen voor de Notificatie Service samen.
De eisen zijn zo veel mogelijk SMART geformuleerd en sluiten aan op het functioneel overzicht en de context.
Waar relevant verwijzen we naar architectuurkeuzes in de ADR’s en ondersteunende documentatie.</p><h3 id=overzicht-1>Overzicht</h3><p>De onderstaande kwaliteitseisen zijn architectonisch significant en sturen ontwerp- en implementatiekeuzes:</p><ul><li>Beveiliging & Privacy (AVG, authenticatie/authorisatie, dataminimalisatie)</li><li>Beschikbaarheid & Continuïteit</li><li>Performance & Schaalbaarheid</li><li>Betrouwbaarheid & Afleverzekerheid (deliverability, retries)</li><li>Auditability & Logging (LDV)</li><li>Interoperabiliteit & Open Standaarden</li><li>Observeerbaarheid (monitoring, metrics, tracing)</li><li>Herstelbaarheid (back-up/restore, DR)</li><li>Toegankelijkheid & Gebruiksvriendelijkheid (waar van toepassing voor beheer/UI)</li></ul><p>Waar zaken bewust buiten scope vallen, is dit expliciet benoemd.</p><h4 id=beveiliging--privacy>Beveiliging & Privacy</h4><ul><li>Authenticatie: Service‑to‑service authenticatie via OIDC/OAuth 2.0 (conform ADR 0006). Tokens met beperkte scopes, geen long‑lived secrets in code.</li><li>Autorisatie: Scope‑gebaseerde autorisatie per dienst/dienstverlener, met dataminimalisatie. Alleen minimaal noodzakelijke persoonsgegevens worden verwacht en niet redundantly opgeslagen.</li><li>Privacy/AVG: verwerkingsregister en grondslagregistratie op orde (AVG art. 6 en 30). DPIA uitgevoerd vóór productie. Pseudonimiseer of hash waar mogelijk correlatie‑ID’s zonder persoonsherleidbaarheid in logs.</li><li>Dataretentie: operationele logs max. 90 dagen; audit‑logs conform bewaartermijnen uit ADR 0005/0007. Payloads met persoonsgegevens niet in applicatielogs opslaan.</li><li>Transport & opslag: TLS 1.2+ in transit; secrets via sealed secrets/secret manager; encryptie‑at‑rest waar toepasbaar.</li></ul><h4 id=beschikbaarheid--continuïteit>Beschikbaarheid & Continuïteit</h4><ul><li>Doel beschikbaarheid betafase: ≥ 50% tijdens kantoortijden. Doel productie: ≥ 99,9% 24x7 (excl. gepland onderhoud). Vastgelegd als SLO en gemonitord.</li><li>Onderhoud: onaangekondigd mogelijk in betafase; productie onderhoud gecommuniceerd via standaard releaseproces.</li><li>Degradatie: bij uitval van een kanaal moet de service gedegen degraderen (queueing, retries, failover) zonder dat upstream systemen blokkeren.</li></ul><h4 id=performance--schaalbaarheid>Performance & Schaalbaarheid</h4><ul><li>TODO, dit is een beetje verzonnen BS, maar zoiets moeten we gaan bepalen.</li><li>Aanname notificatieverzoek (API): p95 latency ≤ 150 ms binnen hetzelfde DC; p99 ≤ 300 ms (excl. downstream kanaal‑roundtrip).</li><li>Callback‑verwerking: p95 ≤ 100 ms per event; idempotent binnen 24 uur zodat dubbele provider‑callbacks geen inconsistenties veroorzaken.</li><li>Throughput initiële doelstelling: 50 notificaties/sec per instance; horizontaal schaalbaar naar ≥ 500/sec door te schalen.</li><li>Wachtrijen gebruiken back‑pressure; geen onbegrensde in‑memory buffers. Batch‑publish naar providers waar toegestaan.</li></ul><h4 id=betrouwbaarheid--afleverzekerheid>Betrouwbaarheid & Afleverzekerheid</h4><ul><li>Retries: Exponentiële back‑off per kanaal; max retry‑duur configureerbaar. Niet‑afleverbare berichten gaan naar DLQ met reden.</li><li>Ordering: Geen harde ordering‑garantie over kanalen, wel best‑effort ordering.</li><li>Statusmodellering: eenduidige statussen (Geaccepteerd, In de wachtrij geplaatst, Verzonden, Geleverd, Mislukt, Verlopen). Overgangen zijn audit‑baar en herleidbaar.</li></ul><h4 id=auditability--logging-ldv>Auditability & Logging (LDV)</h4><ul><li>Audit log: conform ADR 0005 en ADR 0007. Mutaties en externe afleverresultaten worden gelogd.</li><li>Onweerlegbaarheid: timestamps (UTC), correlatie‑ID, provider‑referenties en verificatie op event‑integriteit. Toegang tot audit‑logs strikt geautoriseerd.</li></ul><h4 id=interoperabiliteit--open-standaarden>Interoperabiliteit & Open Standaarden</h4><ul><li>API‑contracten in OpenAPI 3.0+, JSON over HTTPS. HTTP‑statuscodes volgens REST best practices.</li><li>Afstemming met Federatief Data Stelsel (FDS) en LDV‑implementatie (ADR 0010).</li></ul><h4 id=observeerbaarheid>Observeerbaarheid</h4><ul><li>Metrics minimaal: request‑latency (p50/p95/p99), error‑rate per endpoint, queue‑diepte, retry‑tellingen, DLQ instroom/doorlooptijd, callback‑verwerkingstijden.</li><li>Tracing: Tracing over inkomende verzoeken, provider‑aanbieding en callbacks; correlatie‑ID propagatie verplicht.</li><li>Logging: Log op INFO/WARN/ERROR; geen persoonsgegevens in logs, gebruik referenties/ID’s.</li></ul><h4 id=herstelbaarheid-backuprestore-dr>Herstelbaarheid (Back‑up/Restore, DR)</h4><ul><li>TODO, dit is een beetje verzonnen BS, maar zoiets moeten we gaan bepalen.</li><li>RPO/RTO: pilot RTO ≤ 1 werkdag; productie RPO ≤ X minuten, RTO ≤ Y minuten (waarden nader te bepalen met beheer).</li><li>Back‑ups: TODO hebben we hier iets van backups, van berichten die nog net niet verzonden zijn ofzo?</li><li>DLQ‑replay: gecontroleerde replay voorziening met filtering om incidenten te herstellen zonder duplicaten.</li></ul><h3 id=toegankelijkheid--gebruiksvriendelijkheid>Toegankelijkheid & Gebruiksvriendelijkheid</h3><ul><li>Frontend voldoet aan WCAG 2.1 A+AA; toetsing via Lighthouse en handmatige audit.</li><li>Ondersteunde browsers: Chrome, Edge, Safari, Firefox (laatste twee versies), inclusief responsive weergave, conform beleid Rijksoverheid.</li></ul><h3 id=open-standaarden>Open Standaarden</h3><p>TODO iets over forum standaardisatie en beslisboom open standaard</p><h3 id=kwaliteitsmeting-en-borging>Kwaliteitsmeting en borging</h3><ul><li>Geautomatiseerde kwaliteitscontroles (linting, security scanning/CVE), contracttests op API’s in CI/CD.</li><li>Lighthouse voor eventuele UI’s; Accessibility & Best Practices prioriteit. SEO/PWA niet van toepassing.</li><li>SLO’s/SLA’s worden actief gemonitord; afwijkingen leiden tot incidenten en verbeteracties.</li></ul><h3 id=buiten-scope--expliciete-uitsluitingen>Buiten scope / expliciete uitsluitingen</h3><ul><li>Offline‑first gebruik is uitgesloten.</li></ul><h2 id=beperkingen>Beperkingen</h2><h3 id=inleiding-2>Inleiding</h3><p>Deze sectie beschrijft de expliciete randvoorwaarden en beperkingen waarbinnen de Notificatie Service wordt ontworpen en gerealiseerd.
Doel is om gemaakte keuzes en context te borgen en later te kunnen herleiden waarom bepaalde opties zijn overwogen.</p><h3 id=overzicht-2>Overzicht</h3><p>De volgende categorieën beperkingen zijn van toepassing. Per punt noemen we wat de beperking inhoudt, door wie/waarom deze is opgelegd en de impact op de architectuur.</p><h4 id=organisatorische-en-tijdbudget-beperkingen>Organisatorische en tijd/budget beperkingen</h4><ul><li>Betafase: lever een werkende beta met kernfunctionaliteit (aanname, routering, status/callbacks, retries/DLQ) binnen beperkte tijd en middelen. Opgelegd door programma. Impact: focus op ‘must haves’; nice-to-haves en minder gebruikte kanalen worden gefaseerd toegevoegd. Ontwerp blijft uitbreidbaar richting productie.</li></ul><h4 id=identiteit-authenticatie-en-autorisatie>Identiteit, authenticatie en autorisatie</h4><ul><li>Service‑to‑service authenticatie via OIDC/OAuth2 verplicht (ADR 0006). Opgelegd door rijksbeleid en interoperabiliteitseisen. Impact: geen eigen credential management; integratie met IDP/token provider bepaalt token‑handling; korte TTL’s en beperkte scopes.</li><li>Scope‑gebaseerde autorisatie voor dienstverleners via FDS; scopes beperken toegang tot minimaal noodzakelijke rechten (least privilege) en doelbinding. Impact: alle API’s moeten scopes/claims afdwingen.</li></ul><h4 id=juridisch-en-compliance>Juridisch en compliance</h4><ul><li>AVG en LDV‑vereisten (ADR 0007, 0010): auditeerbare gebeurtenissen, transparantie en bewaartermijnen zijn verplicht; geen persoonsgegevens in applicatielogs, alleen referenties/ID’s. Opgelegd door wet‑ en regelgeving. Impact: centrale auditlog, correlatie‑ID’s en idempotentie zijn noodzakelijk; logging wordt gestructureerd ingericht m.b.v LDV.</li><li>Bewijslast/afleverbewijs: afleverstatus en relevante provider‑referenties moeten reproduceerbaar zijn. Impact: eenduidige statusmodellering en opslag van provider‑referenties zonder overtreding dataminimalisatie.</li></ul><h4 id=technologiestack-en-standaarden>Technologiestack en standaarden</h4><ul><li>API’s in OpenAPI 3.0+, JSON over HTTPS; gebruik van standaard HTTP‑protocollen. Opgelegd door interoperabiliteit. Impact: geen propriëtaire protocollen; contract‑first ontwikkeling.</li><li>Digitoegankelijk wordt rekening mee gehouden bij het ontwikkelen van front-end zaken. Opgelegd door UX‑kaders Rijksoverheid. Impact: UI‑componentkeuze is beperkt; consistentie en toegankelijkheid worden geborgd.</li><li>Java in combinatie met Quarkus. Opgelegd door beoogde beheerpartij. Impact: minimaal.</li></ul><h4 id=integraties-en-afhankelijkheden>Integraties en afhankelijkheden</h4><ul><li>Afhankelijkheid van kanaalproviders/voorzieningen (bijv. NotifyNL). Opgelegd door functionele doelstelling en bestaande voorzieningen. Impact: beschikbaarheid/performance mede bepaald door externe SLA’s; timeouts, retries, circuit breakers en back‑pressure noodzakelijk.</li><li>Callbackmechanismen zijn provider‑gedreven en niet uniform. Impact: normalisatielaag/adapters nodig; idempotente event‑verwerking en DLQ verplicht.</li></ul><h4 id=deploy--en-hostingkader>Deploy- en hostingkader</h4><ul><li>Uitrol op picard platform van Logius. Opgelegd door beoogde beheerpartij. Impact: keuze voor specifieke PaaS‑diensten of databases kan beperkt zijn; encryptie‑at‑rest en netwerkpolicies volgen platform‑standaard.</li><li>Netwerkbeperkingen: alleen uitgaand verkeer naar whitelisted endpoints. Impact: service discovery en integraties moeten binnen deze restricties werken; egress‑controle en proxy’s waar nodig.</li></ul><h4 id=ontwikkelproces-en-team>Ontwikkelproces en team</h4><ul><li>Gedeelde capaciteit met andere deelprojecten (Profiel service, MOZa-Portaal, BBO). Opgelegd door programma. Impact: prioritering op kernflows, gefaseerde oplevering; automatisering (CI/CD, contracttests) is essentieel om snelheid/kwaliteit te borgen.</li></ul><h4 id=data-opslag-en-retentie>Data, opslag en retentie</h4><ul><li>Geen langdurige opslag van berichtinhoud met persoonsgegevens in operationele logs; minimale opslag van status en referenties. Opgelegd door AVG. Impact: design richt op metadata‑opslag en verwijzingen i.p.v. payloads; retentiebeleid afdwingen (auditlogs conform ADR 0005/0007).</li><li>Greenfield start, geen migratie van oude notificatie historiek.</li></ul><h3 id=waarom-deze-beperkingen-ertoe-doen>Waarom deze beperkingen ertoe doen</h3><p>Beperkingen versnellen ontwerp en implementatie, maar sturen ook de architectuur:</p><ul><li>Federatieve auth/scopes vereisen strikte scheiding en dataminimalisatie</li><li>AVG dwingt auditability en gestructureerde logging</li><li>Afhankelijkheid van externe providers vereist robuuste integratiepatronen (timeouts, retries, circuit breakers, DLQ) en een eenduidig statusmodel.
Door deze constraints expliciet te maken, voorkomen we schijnbaar ‘vreemde’ keuzes achteraf.</li></ul><h3 id=verwijzingen>Verwijzingen</h3><ul><li>ADR 0002 – Notify onderzoek</li><li>ADR 0003 – Scenario bepaling</li><li>ADR 0005 – AuditLog & EventSourcing</li><li>ADR 0006 – Federatieve authenticatie en autorisatie op basis van OIDC en eIDas</li><li>ADR 0007 – Logboek Dataverwerking (LDV)</li><li>ADR 0009 – NL Design System</li><li>ADR 0010 – LDV implementatie</li></ul><h2 id=design-principes>Design Principes</h2><h3 id=inleiding-3>Inleiding</h3><p>Het doel van dit hoofdstuk is om expliciet te maken welke principes we volgen, zodat ontwerp- en implementatiekeuzes consistent en uitlegbaar zijn voor alle betrokkenen.
Waar van toepassing verwijzen we naar onderliggende ADR’s en overige documentatie.</p><h3 id=principes>Principes</h3><p>De onderstaande principes ondersteunen de kwaliteitseisen in het kwaliteitseisen hoofdstuk
en vormen samen met de ADR’s de basis voor ontwerpkeuzes in de software‑architectuur van de Notificatie Service.</p><ul><li><p>Open standaarden, tenzij
We geven de voorkeur aan open, breed gedragen standaarden voor interoperabiliteit.
Voorbeelden: OpenAPI 3 voor API’s, JSON/HTTP, OIDC/OAuth 2.0 voor service‑to‑service authenticatie.</p></li><li><p>Contract‑first API‑ontwikkeling (OpenAPI)
API’s worden beschreven in OpenAPI; semantic versioning op contracten; backward compatibility binnen een major versie.
Documentatie en try‑out via Swagger/Redoc. Contracttests bewaken compatibiliteit met afnemers en providers.</p></li><li><p>Kanaal‑agnostische interfaces, adapters per provider
Het domeinmodel en de publieke API abstraheren kanaalspecifieke details.
Integraties met providers (bijv. NotifyNL/OMC) gebeuren via adapters/ports, zodat providers vervangbaar zijn zonder breaking changes voor afnemers.</p></li><li><p>Beveiliging en privacy by design
Alleen noodzakelijke gegevens, least‑privilege scopes, encryptie in transit, geen persoonsgegevens in logs.
Audit van mutaties en statusovergangen. Pseudonimiseer referenties waar mogelijk.
Verwijzingen: ADR 0005, ADR 0006, ADR 0007, ADR 0010.</p></li><li><p>Idempotentie en correlatie als first‑class concerns
Callback‑ en statusupdates zijn idempotent, herhaalde provider‑events veroorzaken geen dubbele acties.</p></li><li><p>Eenduidig statusmodel en callback‑gedreven verwerking
Notificaties volgen een expliciet statusmodel (Ex.Geaccepteerd, In de wachtrij geplaatst, Verzonden, Geleverd, Mislukt, Verlopen).
Callbacks en polling leveren consistente, herleidbare staten op, state transitions zijn auditeerbaar.</p></li><li><p>Betrouwbaarheid via retries, back‑off en DLQ
Tijdelijke fouten worden behandeld met exponentiële back‑off, structurele fouten gaan naar een DLQ met reden.
Replay van DLQ gebeurt gecontroleerd en gefilterd om duplicaten te vermijden.</p></li><li><p>Resilience patterns standaard
Timeouts, circuit breakers, bulkheads en back‑pressure op queues beschermen tegen cascaderende fouten en provider‑uitval.</p></li><li><p>Hoge cohesie, lage koppeling
Duidelijke scheiding tussen public API, applicatie‑/routeringslogica, provider‑adapters en persistente lagen.
Modules hebben een beperkte verantwoordelijkheid en communiceren via expliciete contracten.</p></li><li><p>Stateless services
Instances zijn stateless; state zit in expliciete data stores (status, audit) en messaging.
Dit vereenvoudigt horizontale schaalbaarheid en rolling upgrades.</p></li><li><p>Consistente foutafhandeling en API‑conventies
RESTful paden, semantisch correcte HTTP‑methoden en statuscodes, eenduidige foutstructuur (problemdetails).
Heldere, mens‑ en machineleesbare foutmeldingen zonder persoonsgegevens.</p></li><li><p>Configuratie boven code voor kanaalbeleid
Kanaalkeuze, throttling, blackout‑windows en provider‑prioriteiten zijn runtime‑configureerbaar (feature flags waar passend) en niet hard‑gecodeerd.</p></li><li><p>Versiebeheer en gecontroleerde uitrol
Backward‑compatible wijzigingen worden gefaseerd uitgerold, breaking changes alleen in nieuwe major.
Feature flags ondersteunen gefaseerde activatie per kanaal/provider.</p></li><li><p>Testbaarheid en kwaliteit geautomatiseerd
Unit‑ en integratietests voor statusmachine en adapters, contracttests met afnemers en providers, performance‑ en soak‑tests op queues en callbacks.</p></li></ul><h2 id=software-architectuur>Software architectuur</h2><h3 id=architectuurschets-notificeren>Architectuurschets Notificeren</h3><p>Het eerste onderwerp van het programma om te verkennen is een Rijksbrede voorziening voor het notificeren, waarbij een kanaalherstel functionaliteit een vereiste is om te kunnen voldoen aan de <a href=https://www.digitaleoverheid.nl/overzicht-van-alle-onderwerpen/wetgeving/wet-modernisering-elektronisch-bestuurlijk-verkeer/ target=_blank rel="external noopener noreferrer">Wet Modernisering Elektronisch Bestuurlijk Verkeer (MEBV)</a>.</p><p>Daarvoor zijn door Paul Janssen, architect bij de VNG, een aantal scenario&rsquo;s geschetst die verschillende situaties oplossen in verschillende evoluties van het notificatie proces. Wij hebben daaruit een selectie van 2 scenarios uitgewerkt in prototypes, namelijk #2 en #8. Naar aanleiding van verder onderzoek is gebleken dat er nog een extra scenario nodig is, welke we tot scenario #9 hebben benoemd, waarbij ook het kanaalherstel wordt gefasciliteerd.</p><iframe id=structurizr-diagram src="/diagrammen/index.html?iframe=structurizr-diagram#NotificatieServiceContext" width=100% height=800px></iframe><p>In het Notificatie Service context diagram is de Notificatie Service uitgewerkt en wordt weergegeven hoe de drie scenario’s interacteren met de Notificatie Service. De belangrijkste aandachtspunten in deze afbeelding zijn de vier services die binnen het Logius-landschap opereren: de Berichtenbox voor Burgers en Ondernemers (BBO), de Kanaalhersteldienst, de Notificatie Service en de Profiel Service. De eerste twee zijn grijs weergegeven om aan te duiden dat het bestaande systemen betreft.</p><iframe id=structurizr-diagram src="/diagrammen/index.html?iframe=structurizr-diagram#NotificatieServiceContainer" width=100% height=800px></iframe><p>In het Notificatie Service Container Diagram wordt verder ingezoomd op de onderdelen van de Notificatie Service. Deze bestaat uit twee componenten: NotifyNL en de Kennisgeving Service.</p><p>Daarnaast zijn ook de Kanaalhersteldienst en de Profiel Service opgenomen. Deze twee componenten zijn bepalend voor de onderlinge verschillen tussen de drie scenario’s: de BD maakt gebruik van zowel de Profiel Service als de Kanaalhersteldienst, het UWV raadpleegt enkel de Profiel Service, en de DV maakt van geen van beide gebruik.<br>Meer over dit onderscheid wordt zichtbaar in het scenario onder het kopje <em>Belastingdienst</em>, waarin beide componenten actief worden ingezet.</p><p>De drie scenario’s illustreren verschillende vormen van notificaties. Scenario 2 betreft een attendering, terwijl scenario’s 8 (UWV) en 9 (BD) betrekking hebben op kennisgevingen.</p><h4 id=scenario-2>Scenario 2</h4><p>Dit is nog steeds het eenvoudigste scenario: de DV roept hierbij rechtstreeks NotifyNL aan, die vervolgens de notificatie verstuurt naar de zakelijke gebruiker. De Profiel Service wordt hierbij niet gebruikt, wat betekent dat DV zelf de contactgegevens moet aanleveren. Ook wordt de Kanaalhersteldienst niet aangeroepen; bij een kanaalstoring zou DV dit dus zelf moeten afhandelen.</p><h4 id=scenario-8>Scenario 8</h4><p>In scenario 8, vertegenwoordigd door het DV, wordt eerst de contactinformatie opgehaald bij de Profiel Service voordat NotifyNL wordt aangeroepen om de notificatie te versturen. Dit betekent dat er in geval van kanaaluitval geen kanaalherstel plaatsvindt vanuit de Notificatie Service.</p><h4 id=scenario-9>Scenario 9</h4><p>In dit scenario roept de BD de Berichtenbox voor Burgers en Ondernemers (BBO) aan, die vervolgens het notificatieproces namens hen uitvoert. De BBO haalt de profielinformatie op bij de Profiel Service en geeft deze door aan de Kennisgeving Service. Deze is vervolgens verantwoordelijk voor het versturen van de notificatie naar NotifyNL.</p><p>Belangrijk om te vermelden is dat de BD ook de mogelijkheid heeft om het notificatieproces niet via de BBO, maar rechtstreeks te initiëren via de Kennisgeving Service. In dat geval slaat de BD de BBO over en levert zelf de benodigde gegevens aan. De verdere afhandeling, waaronder het ophalen van profielinformatie en het versturen van de notificatie naar NotifyNL, verloopt vervolgens identiek.</p><p>Indien het afleveren van de notificatie mislukt door kanaaluitval, start de Kennisgeving Service automatisch het kanaalherstelproces. Hierbij worden opnieuw de adresgegevens opgehaald bij het handelsregister, waarna deze worden doorgegeven aan de Kanaalhersteldienst voor verdere afhandeling.</p><h3 id=de-scenarios>De scenario&rsquo;s</h3><p>In dit hoofdstuk worden de drie scenario’s verder toegelicht. Zie ook <a href=/workspace/decisions#3>ADR-0003</a> en hoofdstuk 2.8 voor aanvullende context.
In de onderstaande diagram worden alle 3 de scenarios tegelijk weergegeven.</p><iframe id=structurizr-diagram src="/diagrammen/index.html?iframe=structurizr-diagram#DVContainer" width=100% height=800px></iframe><h4 id=scenario-2-1>Scenario 2</h4><p>Dit scenario representeert het versturen van een <em>attendering</em>.<br>De RVO beschikt over een interne service die notificaties (e-mail, sms of brief) wil versturen naar zakelijke gebruikers. Deze service roept rechtstreeks de Notificatie Service aan en levert daarbij zelf de benodigde contactgegevens aan. De Notificatie Service verstuurt de notificatie direct.</p><p>Als het afleveren van de notificatie mislukt (bijvoorbeeld door kanaalproblemen), meldt de Notificatie Service dit terug aan de RVO. De verdere afhandeling van de fout ligt volledig bij de RVO.</p><h4 id=scenario-8-1>Scenario 8</h4><p>Scenario 8 is functioneel uitgebreider dan scenario 2. Ook hier is sprake van een interne service — de DV Service — die een notificatie wil versturen naar een zakelijke gebruiker. In plaats van direct met de Notificatie Service te communiceren, stuurt de DV Service de aanvraag door naar een Output Management Component (OMC).</p><p>De OMC is verantwoordelijk voor het ophalen van de contactgegevens bij de Profiel Service. Met deze informatie wordt de notificatie via de Notificatie Service verzonden. In dit scenario is er nog geen sprake van geautomatiseerd kanaalherstel: als aflevering faalt, is het aan de OMC of de DV om het probleem op te lossen.</p><h4 id=scenario-9-1>Scenario 9</h4><p>Scenario 9 lijkt in grote lijnen op scenario 8, maar bevat enkele technische verschillen.</p><p>De BD Service initieert de verzending van een notificatie naar een zakelijke gebruiker. De aanvraag wordt doorgestuurd naar de OMC, die — net als in scenario 8 — de contactinformatie ophaalt bij de Profiel Service.</p><p>Daarna heeft de BD twee routes om de notificatie te versturen: direct via de Notificatie Service of indirect via de BBO. In beide gevallen verloopt het proces grotendeels hetzelfde en is het eindresultaat identiek. Bij directe verzending stuurt de BD de notificatie rechtstreeks naar de Notificatie Service. In het geval van de BBO-route levert de OMC de benodigde gegevens aan bij de Berichtenbox voor Burgers en Ondernemers (BBO), die op haar beurt contact opneemt met de Notificatie Service om de notificatie af te leveren.</p><p>Als de Notificatie Service een foutmelding geeft vanwege kanaaluitval, start de Kennisgeving Service, een container binnen de Notificatie Service, automatisch het kanaalherstelproces. Daarbij worden de adresgegevens opgehaald bij de het handelsregister en doorgegeven aan de Kanaalhersteldienst voor verdere afhandeling.</p><h2 id=code>Code</h2><h2 id=data>Data</h2><h2 id=deployment>Deployment</h2><h3 id=view>View</h3><iframe id=structurizr-diagram src="/diagrammen/index.html?iframe=structurizr-diagram#NotificatieServiceDeployment" width=100% height=800px></iframe><h3 id=omgeving>Omgeving</h3><h4 id=broncode>Broncode</h4><h2 id=beheer-en-support>Beheer en Support</h2></div></article><aside class=toc><h2>Op deze pagina</h2><nav id=TableOfContents><ul><li><a href=#context>Context</a><ul><li><a href=#uitdagingen>Uitdagingen</a></li><li><a href=#doel>Doel</a></li><li><a href=#inleiding>Inleiding</a></li><li><a href=#overzicht>Overzicht</a><ul><li><a href=#kernfunctionaliteiten-in-het-kort>Kernfunctionaliteiten in het kort:</a></li><li><a href=#belangrijkste-processen-en-informatiestromen>Belangrijkste processen en informatiestromen:</a></li><li><a href=#scenarios>Scenario’s</a></li></ul></li><li><a href=#inleiding-1>Inleiding</a></li><li><a href=#overzicht-1>Overzicht</a><ul><li><a href=#beveiliging--privacy>Beveiliging & Privacy</a></li><li><a href=#beschikbaarheid--continuïteit>Beschikbaarheid & Continuïteit</a></li><li><a href=#performance--schaalbaarheid>Performance & Schaalbaarheid</a></li><li><a href=#betrouwbaarheid--afleverzekerheid>Betrouwbaarheid & Afleverzekerheid</a></li><li><a href=#auditability--logging-ldv>Auditability & Logging (LDV)</a></li><li><a href=#interoperabiliteit--open-standaarden>Interoperabiliteit & Open Standaarden</a></li><li><a href=#observeerbaarheid>Observeerbaarheid</a></li><li><a href=#herstelbaarheid-backuprestore-dr>Herstelbaarheid (Back‑up/Restore, DR)</a></li></ul></li><li><a href=#toegankelijkheid--gebruiksvriendelijkheid>Toegankelijkheid & Gebruiksvriendelijkheid</a></li><li><a href=#open-standaarden>Open Standaarden</a></li><li><a href=#kwaliteitsmeting-en-borging>Kwaliteitsmeting en borging</a></li><li><a href=#buiten-scope--expliciete-uitsluitingen>Buiten scope / expliciete uitsluitingen</a></li></ul></li><li><a href=#beperkingen>Beperkingen</a><ul><li><a href=#inleiding-2>Inleiding</a></li><li><a href=#overzicht-2>Overzicht</a><ul><li><a href=#organisatorische-en-tijdbudget-beperkingen>Organisatorische en tijd/budget beperkingen</a></li><li><a href=#identiteit-authenticatie-en-autorisatie>Identiteit, authenticatie en autorisatie</a></li><li><a href=#juridisch-en-compliance>Juridisch en compliance</a></li><li><a href=#technologiestack-en-standaarden>Technologiestack en standaarden</a></li><li><a href=#integraties-en-afhankelijkheden>Integraties en afhankelijkheden</a></li><li><a href=#deploy--en-hostingkader>Deploy- en hostingkader</a></li><li><a href=#ontwikkelproces-en-team>Ontwikkelproces en team</a></li><li><a href=#data-opslag-en-retentie>Data, opslag en retentie</a></li></ul></li><li><a href=#waarom-deze-beperkingen-ertoe-doen>Waarom deze beperkingen ertoe doen</a></li><li><a href=#verwijzingen>Verwijzingen</a></li></ul></li><li><a href=#design-principes>Design Principes</a><ul><li><a href=#inleiding-3>Inleiding</a></li><li><a href=#principes>Principes</a></li></ul></li><li><a href=#software-architectuur>Software architectuur</a><ul><li><a href=#architectuurschets-notificeren>Architectuurschets Notificeren</a><ul><li><a href=#scenario-2>Scenario 2</a></li><li><a href=#scenario-8>Scenario 8</a></li><li><a href=#scenario-9>Scenario 9</a></li></ul></li><li><a href=#de-scenarios>De scenario&rsquo;s</a><ul><li><a href=#scenario-2-1>Scenario 2</a></li><li><a href=#scenario-8-1>Scenario 8</a></li><li><a href=#scenario-9-1>Scenario 9</a></li></ul></li></ul></li><li><a href=#code>Code</a></li><li><a href=#data>Data</a></li><li><a href=#deployment>Deployment</a><ul><li><a href=#view>View</a></li><li><a href=#omgeving>Omgeving</a><ul><li><a href=#broncode>Broncode</a></li></ul></li></ul></li><li><a href=#beheer-en-support>Beheer en Support</a></li></ul></nav></aside></main><footer><p class=tagline>Eén Overheid. Voor iedereen!</p><nav aria-label="Footer navigatie"><h2>Over deze site</h2><ul><li><a href=/moza-site/preview/pr-34/privacy/>Privacy</a></li><li><a href=/moza-site/preview/pr-34/toegankelijkheid/>Toegankelijkheid</a></li></ul></nav></footer><dialog id=search-modal class=search-modal aria-label=Zoeken data-search-index=/moza-site/preview/pr-34/index.json><div class=search-modal-content><div class=search-modal-header><svg class="search-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5.0 100 11 5.5 5.5.0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75.0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg><input type=search id=search-input class=search-input placeholder=Zoeken... aria-label="Zoek op de website" autocomplete=off autofocus>
<button class=button-ghost id=search-close aria-label=Sluiten><svg class="x-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class=search-filters role=group aria-label="Filter op sectie"><button class="search-filter active" data-section aria-pressed=true>Alles</button>
<button class=search-filter data-section=weekly aria-pressed=false>MOZa Weekly</button>
<button class=search-filter data-section=onderwerpen aria-pressed=false>Onderwerpen</button>
<button class=search-filter data-section=presentaties aria-pressed=false>Presentaties</button></div><ul id=search-results class=search-results aria-label=Zoekresultaten aria-live=polite></ul></div></dialog><button id=highlight-bar class=toast aria-live=polite hidden>
Zoekterm "<span id=highlight-bar-query></span>" is gemarkeerd. Klik hier om de markering te verwijderen.
</button>
<script src=/moza-site/preview/pr-34/js/toc.317ebb0b1691c91a41375bd45b952fdd.js></script></body></html>