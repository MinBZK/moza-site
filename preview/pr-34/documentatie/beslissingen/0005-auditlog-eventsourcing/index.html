<!doctype html><html lang=nl><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>MijnOverheid Zakelijk</title><meta name=description content="Bij MijnOverheid Zakelijk staan ondernemers centraal. Elk uur minder aan gedoe, is een uur meer ondernemen. We zorgen voor overzicht en makkelijk zaken doen. Met elkaar bouwen we zo aan nieuwe digitale snelwegen."><link rel=icon href=/moza-site/preview/pr-34/favicon.ico type=image/x-icon><link rel=stylesheet href=/moza-site/preview/pr-34/css/style.d7b5263c47ca3ec112794ed40ce533e2.css><script src=/moza-site/preview/pr-34/js/bundle.f708e6c53039c684a38ddc8d9c70bc8a.js defer></script></head><body><a href=#main-content class=skip-link>Ga naar de inhoud</a><header><div class=banner><div class=site-info><p class=title><a href=/>MijnOverheid Zakelijk</a></p><p class=tagline>Makkelijk zaken doen met de overheid</p></div><div class=site-logo><a href=/ tabindex=-1 aria-hidden=true><img src=/moza-site/preview/pr-34/images/logo-rijksoverheid.svg alt="Logo Rijksoverheid"></a></div></div><nav class=navbar aria-label=Hoofdnavigatie><a href=/ class=title>MijnOverheid Zakelijk</a><div class=menu><ul><li><a href=/moza-site/preview/pr-34/ data-text=Home>Home</a></li><li><a href=/moza-site/preview/pr-34/over-moza/ data-text="Over MOZa">Over MOZa</a></li><li><a href=/moza-site/preview/pr-34/actueel/ data-text=Actueel>Actueel</a></li><li><a href=/moza-site/preview/pr-34/onderwerpen/ data-text=Onderwerpen>Onderwerpen</a></li><li><a href=/moza-site/preview/pr-34/documentatie/ data-text=Documentatie class=active aria-current=page>Documentatie</a></li><li><a href=/moza-site/preview/pr-34/contact/ data-text=Contact>Contact</a></li></ul><ul class=navbar-right><li><button class=search-trigger aria-label=Zoeken aria-haspopup=dialog><svg class="search-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5.0 100 11 5.5 5.5.0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75.0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg><span class=search-trigger-text>Zoeken...</span>
<kbd class=search-shortcut>/</kbd></button></li><li><button id=theme-toggle class=theme-toggle aria-label="Toggle theme"><svg class="sun" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364-.707.707M6.343 17.657l-.707.707m12.728.0-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg><svg class="moon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg></button></li></ul></div><button class="search-trigger mobile-search" aria-label=Zoeken aria-haspopup=dialog><svg class="search-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5.0 100 11 5.5 5.5.0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75.0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg></button>
<button class="theme-toggle mobile-theme" aria-label="Wissel thema" onclick='document.getElementById("theme-toggle").click()'><svg class="sun" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364-.707.707M6.343 17.657l-.707.707m12.728.0-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg><svg class="moon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg></button>
<button class=toggle aria-label="Menu openen" aria-expanded=false aria-controls=mobile-menu onclick='const expanded=this.getAttribute("aria-expanded")==="false";this.setAttribute("aria-expanded",expanded),this.setAttribute("aria-label",expanded?"Menu sluiten":"Menu openen")'><svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=mobile-menu class=mobile role=navigation aria-label="Mobiel menu"><ul><li><a href=/moza-site/preview/pr-34/>Home</a></li><li><a href=/moza-site/preview/pr-34/over-moza/>Over MOZa</a></li><li><a href=/moza-site/preview/pr-34/actueel/>Actueel</a></li><li><a href=/moza-site/preview/pr-34/onderwerpen/>Onderwerpen</a></li><li><a href=/moza-site/preview/pr-34/documentatie/ class=active aria-current=page>Documentatie</a></li><li><a href=/moza-site/preview/pr-34/contact/>Contact</a></li><li class=mobile-theme-toggle><button class=theme-toggle aria-label="Toggle theme" onclick='document.getElementById("theme-toggle").click()'>
<span class=sun>Light Mode</span>
<span class=moon>Dark Mode</span></button></li></ul></div></nav><nav class=breadcrumb aria-label=Breadcrumb><ol><li><a href=/>Home</a>
<span class=separator aria-hidden=true></span></li><li><a href=/moza-site/preview/pr-34/documentatie/>Documentatie</a>
<span class=separator aria-hidden=true></span></li><li><a href=/moza-site/preview/pr-34/documentatie/beslissingen/>Beslissingen</a>
<span class=separator aria-hidden=true></span></li><li><span class=current aria-current=page></span></li></ol></nav></header><main id=main-content><article><div class=content><h1 id=5-event-sourcing>5. Event Sourcing</h1><p>Date: 2025-10-05</p><h2 id=status>Status</h2><p>Accepted</p><h2 id=context>Context</h2><p>Vanuit de business kregen we de vraag om event sourcing te onderzoeken in de context van de Profiel Service, wat momenteel dus alleen een e-mailadres betreft maar in de toekomst meer zou kunnen bevatten.</p><p>Hieronder een eenvoudig voorbeeld van hoe de tijdlijn van een profiel er uit zou kunnen zien:<br><img src=./images/ProfielTijdlijn.png alt="Profiel tijdlijn" title="Profiel tijdlijn"></p><details><summary>Zie mermaid code</summary><pre tabindex=0><code>mermaid
flowchart TD
    subgraph Profiel Tijdlijn
        E[2025-01-01: ProfielCreated email=1]:::event --&gt; D[2025-02-02: ProfielUpdated email=2]:::event --&gt; C[2025-03-03: ProfielUpdated email=3]:::event --&gt; B[2025-04-04: ProfielDeleted]:::event
    end

    classDef event fill:#e3f2fd,stroke:#2196f3,color:#0d47a1;
</code></pre></details><h3 id=event-sourcing>Event Sourcing</h3><p>Event sourcing is een manier van gegevensopslag waarbij niet de actuele state van een entiteit wordt opgeslagen, maar alle events die tot die state hebben geleid.<br>Elke wijziging aan een profiel, bijvoorbeeld het aanpassen van een e-mailadres of toevoegen van een telefoonnummer, wordt vastgelegd als een apart event.<br>De actuele state van een profiel wordt dan bepaald door alle events in chronologische volgorde opnieuw toe te passen.</p><p>Onderstaande illustratie toont hoe een profiel vanuit de initiële state wordt opgebouwd door het herhalen van events tot de bevraagde versie is bereikt:<br><img src=./images/EventSourceRead.png alt="Event Source Read" title="Event Source Read"></p><details><summary>Zie mermaid code</summary><pre tabindex=0><code>mermaid
flowchart TD
    subgraph Event Sourced Voorbeeld
        X[User Requests Profiel at=2025-02-15]:::action
        A[Base Profiel email=1]:::current
        X --&gt;|Load base state| A
        A --&gt;|Apply event 2025-02-02: email updated to 2| B[Reconstructed Profiel email=2]
    end

    classDef current fill:#c8e6c9,stroke:#2e7d32,color:#1b5e20;
    classDef action fill:#fff9c4,stroke:#fbc02d,color:#f57f17;
</code></pre></details><h3 id=audit-logging>Audit Logging</h3><p>Audit logging daarentegen legt de wijzigingen vast ten opzichte van de huidige state, grootendeels voor audit- of compliance-doeleinden.<br>De primaire opslag blijft de actuele state van het profiel, terwijl de audit log enkel dient voor naspeurbaarheid en historische reconstructie wanneer nodig.</p><p>Het verschil met event sourcing is dat audit logging niet bedoeld is om de actuele state telkens opnieuw op te bouwen, maar om een historische reconstructie mogelijk te maken wanneer dat gevraagd wordt.<br>Dit kan bijvoorbeeld door middel van een reverse delta read, zoals hieronder geïllustreerd:<br><img src=./images/ReverseDeltaRead.png alt="Reverse Read Voorbeeld" title="Reverse Read Voorbeeld"></p><p>Een reverse delta read betekent het toepassen van de opgeslagen audit logs in volgorde van nieuwste eerst, tot aan de datum die de ondernemer of toezichthouder heeft opgegeven.<br>Hiermee kan de state van een profiel op een eerder moment worden herleid, zonder dat het volledige eventverloop hoeft te worden opgebouwd.</p><details><summary>Zie mermaid code</summary><pre tabindex=0><code>mermaid
flowchart TD
    subgraph Reverse Read Voorbeeld
        X[User requests Profiel at=2025-02-15]:::action
        A[Current Profiel email=3]:::current
        X --&gt;|Load current state| A
        A --&gt;|Apply reverse deltas: undo 2025-04-04 &amp; 2025-03-03| Y[Reconstructed Profiel email=2]
    end

    classDef current fill:#c8e6c9,stroke:#2e7d32,color:#1b5e20;
    classDef action fill:#fff9c4,stroke:#fbc02d,color:#f57f17;
</code></pre></details><h2 id=decision>Decision</h2><p>Na het afwegen van beide scenario’s hebben we geconcludeerd dat Audit Logging op dit moment geschikter is, maar we blijven de toekomst in het oog houden, waarin een uitgebreidere profielservice mogelijk meer voordeel haalt uit event sourcing.
De belangrijkste reden is dat bijna elke use case enkel de laatste versie van het profiel nodig heeft.<br>Bij Event Sourcing zou dan telkens opnieuw het hele profiel moeten worden opgebouwd, wat onnodige complexiteit en performancekosten met zich meebrengt voor de huidige schaal en scope.</p><h2 id=consequences>Consequences</h2><ul><li>We implementeren Audit Logging als eerste stap, inclusief ondersteuning voor reverse reads, zodat historische reconstructie mogelijk blijft.</li><li>De architectuur wordt zodanig opgezet dat een eventuele migratie naar Event Sourcing in de toekomst niet wordt uitgesloten.</li><li>Voor nu blijft de Profiel Service state-based met audit trail.</li></ul></div></article><aside class=toc><h2>Op deze pagina</h2><nav id=TableOfContents><ul><li><a href=#status>Status</a></li><li><a href=#context>Context</a><ul><li><a href=#event-sourcing>Event Sourcing</a></li><li><a href=#audit-logging>Audit Logging</a></li></ul></li><li><a href=#decision>Decision</a></li><li><a href=#consequences>Consequences</a></li></ul></nav></aside></main><footer><p class=tagline>Eén Overheid. Voor iedereen!</p><nav aria-label="Footer navigatie"><h2>Over deze site</h2><ul><li><a href=/moza-site/preview/pr-34/privacy/>Privacy</a></li><li><a href=/moza-site/preview/pr-34/toegankelijkheid/>Toegankelijkheid</a></li></ul></nav></footer><dialog id=search-modal class=search-modal aria-label=Zoeken data-search-index=/moza-site/preview/pr-34/index.json><div class=search-modal-content><div class=search-modal-header><svg class="search-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5.0 100 11 5.5 5.5.0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75.0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"/></svg><input type=search id=search-input class=search-input placeholder=Zoeken... aria-label="Zoek op de website" autocomplete=off autofocus>
<button class=button-ghost id=search-close aria-label=Sluiten><svg class="x-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class=search-filters role=group aria-label="Filter op sectie"><button class="search-filter active" data-section aria-pressed=true>Alles</button>
<button class=search-filter data-section=weekly aria-pressed=false>MOZa Weekly</button>
<button class=search-filter data-section=onderwerpen aria-pressed=false>Onderwerpen</button>
<button class=search-filter data-section=presentaties aria-pressed=false>Presentaties</button></div><ul id=search-results class=search-results aria-label=Zoekresultaten aria-live=polite></ul></div></dialog><button id=highlight-bar class=toast aria-live=polite hidden>
Zoekterm "<span id=highlight-bar-query></span>" is gemarkeerd. Klik hier om de markering te verwijderen.
</button>
<script src=/moza-site/preview/pr-34/js/toc.317ebb0b1691c91a41375bd45b952fdd.js></script></body></html>